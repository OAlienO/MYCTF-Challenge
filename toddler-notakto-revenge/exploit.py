#!/usr/bin/env python3
from pwn import *
from Notakto import Notakto
from Notakto.utils import empty_board, pretty_board
from Notakto.constants import BOARD_TEMPLATE
from Notakto.exceptions import NotaktoError

r = remote("bamboofox.cs.nctu.edu.tw", 58793)

def different(A, B):
    return list(map(lambda x: x[0] != x[1], zip(A, B))).index(True)

def recv_board():
    stones = []
    line = r.recvline()
    stones += [line[1], line[5], line[9]]
    r.recvline()
    line = r.recvline()
    stones += [line[1], line[5], line[9]]
    r.recvline()
    line = r.recvline()
    stones += [line[1], line[5], line[9]]
    return stones

def go(move):
    r.sendlineafter("Your move: ", str(move))
    my_stones = recv_board()
    r.recvline()
    word = r.recvline()
    if b"WIN" in word: return -1
    ai_stones = recv_board()
    return different(my_stones, ai_stones)

for i in range(50):
    print("round {}".format(i))
    notakto = Notakto(1)
    while True:
        result = notakto.move_optimize()
        ai_move = go(result.x * 3 + result.y)
        if ai_move == -1: break
        notakto.move(0, ai_move // 3, ai_move % 3)

r.interactive()
