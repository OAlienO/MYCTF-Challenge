#!/usr/bin/env python3
from pwn import *
from Notakto import Notakto
from Notakto.utils import empty_board, pretty_board
from Notakto.constants import BOARD_TEMPLATE
from Notakto.exceptions import NotaktoError

r = remote("bamboofox.cs.nctu.edu.tw", 58794)

def different(A, B):
    return list(map(lambda x: x[0] != x[1], zip(A, B))).index(True)

def recv_board():
    stones = []
    line = r.recvline()
    stones += [line[1], line[5], line[9]]
    r.recvline()
    line = r.recvline()
    stones += [line[1], line[5], line[9]]
    r.recvline()
    line = r.recvline()
    stones += [line[1], line[5], line[9]]
    r.recvline()
    return stones

def go(index, x, y):
    my_stones = []
    ai_stones = []
    r.sendlineafter("Which board: ", str(index))
    r.sendlineafter("Your move: ", str(x * 3 + y))
    for _ in range(5): my_stones.append(recv_board())

    word = r.recvline()
    if b"WIN" in word: return -1
    r.recvline()

    for _ in range(5): ai_stones.append(recv_board())

    for i in range(5):
        try:
            move = different(my_stones[i], ai_stones[i])
            return (i, move)
        except ValueError:
            continue

for i in range(50):
    print("round {}".format(i))
    notakto = Notakto(5)
    while True:
        result = notakto.move_optimize()
        ai_move = go(result.index, result.x, result.y)
        if ai_move == -1: break
        notakto.move(ai_move[0], ai_move[1] // 3, ai_move[1] % 3)

r.interactive()
