#!/usr/bin/env python3
from pwn import *
from base64 import b64encode, b64decode

r = remote("bamboofox.cs.nctu.edu.tw", 58792)

def wrap(text, size):
    ans = []
    for i in range(0, len(text), size):
        ans.append(text[i:i+size])
    return ans

def xorbytes(x, y):
    ans = []
    for x, y in zip(x, y):
        ans.append(bytes([x ^ y]))
    return b''.join(ans)

iv = b"STARWAR888888888"
cipher = b64decode(b"XmmSv7+azqHCSPwBYfsVKVoqq+NpOaWrRHOYlLn3GlRAg4kdAVmEdc5L9koCHcxl5U0Ee28wMqTNdZYzd/BOaynUpmthknT0QdVGLXpx5Oko7QiK7+I0UVFhi8MP0+YFigbKhXMGzuv7ySqhnakeaRhaRGjRvVShMmjL0vitvuw=")
blocks = wrap(iv + cipher, 16)
ans = []

for i in range(1, len(blocks)):
    C2 = blocks[i]
    C1 = blocks[i-1]
    rI2 = b""
    for j in range(16):
        current_pad = j + 1
        set_pad = xorbytes(bytes([current_pad] * j), rI2[::-1])
        for k in range(256):
            guess = b'A' * (16 - 1 - j) + bytes([k]) + set_pad
            r.sendlineafter("Give me something:", b64encode(guess + C2))
            result = r.recvline()
            if b'YES' in result:
                rI2 += bytes([current_pad ^ k])
                break
    I2 = rI2[::-1]
    P2 = xorbytes(C1, I2)
    ans.append(P2)
    print(ans)

print(b''.join(ans).decode('utf-8'))
